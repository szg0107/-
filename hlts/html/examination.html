<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name=viewport content="user-scalable=no">
    <title>Title</title>
    <script type='text/javascript' src='js/pub.js'></script>
    <script type='text/javascript' src='js/check.js'></script>
    <script type='text/javascript' src='js/checkform.js'></script>
</head>

<style>
    .Fruit {
        width: 40px;
        height: 40px;
        border-radius: 20px;
        margin: 30px 20px 30px 10px;
    }

    span {
        width: 80%;
    }
</style>

<body bgcolor="#efeef4" style="font-size: 48px;font-family: Heiti SC;">
<div id="headView" style="background-color: white;margin-top: 60px;margin-left: 30px;margin-right: 30px;border-radius: 20px;padding: 10px 10px 10px 30px;font-weight: bold ;">
    <div>
        <div>
            当前总分:<span id="totalScoreDiv"></span>
        </div>
    </div>
    <div>
        <div>
            本题分值:<span id="scoreDiv"></span>
        </div>
    </div>
    <div>
        <div>
            本题剩余时间:<span id="countDownDiv"></span>秒
        </div>
    </div>
</div>
<ylt.for dataId="1492050791747">
    <div name="question" hidden="true">
        <div style="background-color: white;margin-top: 20px; margin-left: 30px;margin-right: 30px;border-radius: 20px;padding: 30px 10px 10px 30px">
            <input name="TH" value="$value" hidden="true"/>
            <input name="ZY" value="$value" hidden="true"/>
            <div style="font-weight: bold;margin-bottom: 20px">
                <span name="questionIndex"></span>$value
            </div>
            <input name="time" value="$value" hidden="true"/>
            <label><input name="Fruit" type="radio" class="Fruit" value="A"/><span>$value</span></label>
            <br>
            <label><input name="Fruit" type="radio" class="Fruit" value="B"/><span>$value</span></label>
            <br>
            <label><input name="Fruit" type="radio" class="Fruit" value="C"/><span>$value</span></label>
            <br>
            <label><input name="Fruit" type="radio" class="Fruit" value="D"/><span>$value</span></label>
            <br>
            <input name="rightAnswer" value="$value" hidden="true"/>
            <br>
            <input name="score" value="$value" hidden="true"/>
            <br>
        </div>
        <div align="center">
            <button onclick="nextQuestion();"
                    style="background-color: #029ae5;width: 750px;height: 100px;margin-top: 100px;color: white;border-radius: 50px;font-size: 60px;">
                下一题
            </button>
        </div>
    </div>
</ylt.for>












<script>
    var questions = document.getElementsByName('question');
    var headView = document.getElementById('headView');
    if(questions.length == 0){
        headView.hidden = true;
        alert('暂无您专业的考题!');
        var userAgent = navigator.userAgent;
        if (userAgent.indexOf("iPhone") >= 0) {
            window.webkit.messageHandlers.noneQuestion.postMessage(null);
        } else {
        }
    }
    /**
     *
     * 初始化
     *
     * **/
    var totalScoreDiv = document.getElementById('totalScoreDiv');
    var scoreDiv = document.getElementById('scoreDiv');
    scoreDiv.innerHTML = document.getElementsByName('score')[0].value;
    var countDownDiv = document.getElementById('countDownDiv');
    countDownDiv.innerHTML = document.getElementsByName('time')[0].value;
    totalScoreDiv.innerHTML = 0;

    var nowQuestionIndex = 0;

    for(var i = 0 ;i < questions.length;i++){
        indexs = document.getElementsByName('questionIndex');
        var temp = i+1;
        indexs[i].innerHTML='('+temp+'/'+questions.length+')';
    }


    var totalScore = 0;
    questions[nowQuestionIndex].hidden = false;
    var rightCount = 0;
    var totalExaminationNumber = questions.length;
    var ZY = document.getElementsByName('ZY')[0].value;
    var user="";
    <ylt.v message="user">
            $value
    user="$value";
    </ylt.v>


    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = decodeURI(window.location.search).substr(1).match(reg);
        if (r != null) return unescape(r[2]); return null;
    }


    var circleID = getQueryString('id');
    /**
     * 考试批次
     *
     * **/
    var examinationBatch = (new Date()).valueOf();
</script>

<script>
    function nextQuestion() {
        /***
         *
         * 计算当前题目是否得分
         *
         * */
        var rightAnswer = document.getElementsByName('rightAnswer')[nowQuestionIndex].value;
        var score = document.getElementsByName('score')[nowQuestionIndex].value;
        var answer;
        for (var i = 0; i < 4; i++) {
            if (document.getElementsByName('Fruit')[nowQuestionIndex * 4 + i].checked == true) {
                answer = document.getElementsByName('Fruit')[nowQuestionIndex * 4 + i].value;
            }
        }

        if (answer == rightAnswer) {
            totalScore += parseInt(score);
            rightCount++;
        }
        var timestamp = (new Date()).valueOf();
        var TH = document.getElementsByName('TH')[nowQuestionIndex].value;
        var strVResult = sys_doComMandReturn("026", "S_ID=" + timestamp + "&S_KSPC=" + examinationBatch + "&S_KSR=" + user + "&S_KSSJ=" + timestamp + "&S_KSTH=" + TH + "&S_XZDDA=" + answer);
        /**
         *
         * 设置总分
         *
         * **/
        totalScoreDiv.innerHTML = totalScore;
        if (nowQuestionIndex + 1 < questions.length) {
            questions[nowQuestionIndex].hidden = true;
            nowQuestionIndex++;
            questions[nowQuestionIndex].hidden = false;
            scoreDiv.innerHTML = document.getElementsByName('score')[nowQuestionIndex].value;
            countDownDiv.innerHTML = document.getElementsByName('time')[nowQuestionIndex].value;
        } else {

            timestamp = (new Date()).valueOf();
            var accuracy = rightCount / parseFloat(totalExaminationNumber);
            var strVResult = sys_doComMandReturn("025", "S_ID=" + timestamp + "&S_KSPC=" + examinationBatch + "&S_KSQZ=" + circleID + "&S_KSR=" + user + "&S_KSSJ=" + timestamp + "&S_KSZF=" + totalScore + "&S_KSZQL=" + accuracy.toFixed(3) + "&S_KSZY=" + ZY);

            var userAgent = navigator.userAgent;
            window.clearInterval(t2);
            if (userAgent.indexOf("iPhone") >= 0) {
                var dict = {"totalScore":totalScore};
                var userAgent = navigator.userAgent;
                window.webkit.messageHandlers.completeExamination.postMessage(dict);
            } else {
                alert('考试结束：\r您本次的考试成绩为:' + totalScore+'分。' +
                        '\n谢谢使用！');
            }
        }
    }


    function countDown() {
        var second = parseInt(countDownDiv.innerHTML);
        second--;
        countDownDiv.innerHTML = second;
        if (second <= 0) {
            nextQuestion();
        }
    }
    function start() {
        t2 = window.setInterval("countDown()", 1000);
    }
    var t2;


</script>
<script>
    var zongfen = '';
    var zhengquelv = '';

    <ylt.for dataId="1494841229147">

    zongfen = '$value';
    zhengquelv = '$value';
    </ylt.for>
    zhengquelv = parseFloat(zhengquelv)*100;


    if(zongfen != ''){
        var dict = {"zongfen":zongfen,"zhengquelv":zhengquelv};
        var userAgent = navigator.userAgent;
        if (userAgent.indexOf("iPhone") >= 0) {
            window.webkit.messageHandlers.laseExamination.postMessage(dict);
        }else{
            window.callByJs.setValue(zongfen,zhengquelv);
        }
    }else{
        start();
    }
</script>
</body>
</html>
