<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>圈子通知</title>
    <script type='text/javascript' src='js/pub.js'></script>
    <script type='text/javascript' src='js/check.js'></script>
    <script type='text/javascript' src='js/checkform.js'></script>
    <script type='text/javascript' src='res/js/KMoonPub.js'></script>
    <script type='text/javascript' src='res/js/resource.js'></script>
    <meta name=viewport content="user-scalable=no">

    <style>
        .gps_font {
            font-size: 45px;
            color: black;
        }

        .limitLength {
            table-layout: fixed;
            text-overflow: ellipsis;
            -o-text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
        }
    </style>

</head>


<body id="body1" bgcolor="#efeef4">
<div id="timu" style="display:none;width: 100%;height: 120px;background: #029ae5;line-height: 120px;margin-top:0px;border-style: blue; border-width: 1px;"  ><!--微信公众号使用-->
    <img src="res/images/arrow_left_d.png" style="width: 10%;height: 40%;margin-top:0%" onclick="window.history.go(-1);">
    <span id="menu2" style="color: #FFFFFF;font-size: 50px;margin-left:30%;font-family: 微软雅黑;">圈子通知</span>

</div>



<div id="content">
    <ylt.for dataId="1501051502001">

        <div name="warp" style="margin-top: 0px;margin-left: 40px;margin-right: 40px;clear: both;" class="gps_font"  onclick="praise(this);recordLrecord(this.id);clickNotification(this.id);" id="$value">
            <div name="pdf">
                <div class="gps_font" style="background-color: #efeef4;height:100%;margin-top: 30px;overflow:auto;">
                    <!--<div style="float: left;width: 15%;" class="gps_font">主题：</div>-->
                    <div class="limitlength gps_font" style="float: left;width: 98%;margin-left: 10px;">
                        <img name="dian" src="res/images/dianA.png" style="position: relative;z-index: 999;right: 0;top: 0;float: right;width:30px;height:30px;display: none;">
                        <div  name="title" style="float: left;word-break: break-all;word-wrap: break-word;">$value</div>
                    </div>
                </div>
            </div>

            <div style="height: 100px;margin-left: 20px;" align="center">
                <div style="font-size: 35px;color: gray;float: left;margin-top: 30px">
                    $value
                </div>

                <div style="float: left;margin-top: 30px;margin-left: 80px;width: 300px;font-size: 35px;color: gray;">
                    $value
                </div>

                <div style="float:left;margin-top: 30px;margin-left: 80px;width: 200px;">
                   <span style="font-size: 35px;color: gray;border-bottom: 2px solid #efeef4;height: 50px;line-height: 50px;margin-left: 10%">
                    阅读量:
                    <span name="zanCount" id="$value"></span>
                   </span>
                </div>
            </div>

            <div style="background-color: white;clear: both;">
                <hr size="3" style="background: #666;border: 0;">
            </div>
        </div>

    </ylt.for>
</div>
<div id="tishi" class="gps_font" align="center"></div>

<form id="searchForm" action="searchAudio.view" method="post">
    <input id="contentInput" name="content" style="width: 100%;" value="" type="text" hidden="true"/>
    <input id="circleID" name="id" style="width: 100%;" value="" type="text" hidden="true"/>
</form>

</body>



<script>

    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return null;
    }
    function getQueryString1(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = decodeURI(window.location.href).substr(1).match(reg);
        if (r != null) return unescape(r[2]); return null;
    }

    if(getQueryString('content') != null) {
        var contentInput = document.getElementById('contentInput');
        contentInput.value = getQueryString1('content');
        var circleID = document.getElementById('circleID');
        circleID.value = getQueryString('id');
        var searchForm =  document.getElementById('searchForm');
        searchForm.action="circle_notification.view?type="+getQueryString('type')+"&id="+circleID.value+"&reuse="+getQueryString('reuse')+"&w=a";

        /*if(contentInput.value!=''&&contentInput.value!=null){
         var timestamp = new Date().getTime();
         var Searchrecords = sys_doComMandReturn("040", "S_QZBID=" + circleID.value + "&S_SSSJ=" + timestamp + "&S_SSNR=" + contentInput.value+ "&S_ID=" + timestamp+"&S_SSLX=mp3");
         }*/
        searchForm.submit();
    }
</script>

<script>

    var id = getQueryString('id');

    function updateZan() {
        var zans = document.getElementsByName('zanCount');
        /**如果name=null将已赞隐藏**/
        for (var i = 0; i < zans.length; i++) {
            document.getElementsByName('zanCount')[i].innerHTML = contributeCountTest(id, zans[i].id);
        }
    }
    updateZan();

    /**贡献的被赞数**/
    function contributeCountTest(circleID, fileID) {

        var newResultdfdfd = getTx("circleID=" + circleID + "&fileID=" + fileID, "phonejumpA.view");

        var likeileFileCount = incision(newResultdfdfd, "likeileFileCount=", ";");

        var count;
        if (likeileFileCount == "" || likeileFileCount == null || likeileFileCount == "null") {
            return count = 0;
        } else {
            return count = parseInt(likeileFileCount);
        }
    }


    /**点击小手**/
    function praise(zan) {
        var timestamp = new Date().getTime();
        var newResult = getTx("lebie=inform&wzid=" + zan.id, "phoneJump.view");
        var dianzanID = incision(newResult, "dianZan=", ";");
        /*
         * 未赞
         * */
        if (dianzanID == "" || dianzanID == null || dianzanID == undefined || dianzanID == 'null') {
            var strVResult = sys_doComMandReturn("033", "S_DZWZ=" + zan.id + "&S_ID=" + timestamp + "&S_LB=inform");
            var dianzanshu = contributeCountTest(id, zan.id);
            var newdianzanshu = parseInt(dianzanshu) + 1;
            /**新点赞数**/
            var strVResultbbb = sys_doComMandReturn("045", "S_BDZS=" + newdianzanshu + "&S_ID=" + zan.id + "&S_QZBID=" + id);
            updateZan();
        }
    }


    function incision(Result, start, over) {
        Result = Result.substr(Result.indexOf(start));
        Result = Result.substr(0, Result.indexOf(over));
        /**alert("后"+strResult);**/
        Result = Result.split(start)[1];
        return Result;
    }
</script>


</body>

<script type="text/javascript">
    var content = document.getElementById('content');
    if (content.children.length == 0) {
        tishi.innerHTML = "当前圈子还没有通知!";
    }
    function clickNotification(notificationId) {
        var content = {"notificationId": notificationId};
        if (getQueryString('kind') != null) {
            this.location.href="Inform_the_details.view?kind=tzxq&circleID="+getQueryString('id')+"&id="+notificationId;
        }
        var userAgent = navigator.userAgent;
        if (userAgent.indexOf("iPhone") >= 0) {
            window.webkit.messageHandlers.clickNotification.postMessage(content);
        } else {
            window.callByJs.setValue(notificationId);
        }
    }

    function recordLrecord(ID){

        addWatchCount(getQueryString('id'),ID,'inform');

        /*记录学习情况*/
        var timestamp = new Date().getTime();
        var record_Learning = sys_doComMandReturn("030", "S_QZID=" +getQueryString('id') + "&S_WAID=" +ID + "&S_XXLX=inform" + "&S_XXSJ=" +timestamp+ "&S_ID=" + timestamp);
    }




    function xianShiYuanDian(){
        var imgs=document.getElementsByName('dian');
        var imgs2=document.getElementsByName('warp');
        var gongSiBiXiuID=new Array();
        var gongSiBiXiuCongFU=new Array();
        var gongSiBiXiuCongType=new Array();
    <ylt.for dataId="1503383626200">
                gongSiBiXiuID.push('$value');
        gongSiBiXiuCongFU.push('$value');
        gongSiBiXiuCongType.push('$value');
    </ylt.for>
        var xinBiXiuID=array_assignment(gongSiBiXiuCongType,gongSiBiXiuID,getQueryString('type'));
        if(gongSiBiXiuCongFU.length!=0){
            if(array_contain(gongSiBiXiuCongFU,'zero')&&array_contain(gongSiBiXiuCongType,getQueryString('type'))){
                for(var i=0;i<xinBiXiuID.length;i++){
                    for(var u=0;u<imgs2.length;u++){
                        if(xinBiXiuID[i]==imgs2[u].id){
                            imgs[u].style.display="inline";
                        }
                    }
                }
            }
            if(array_contain(gongSiBiXiuCongFU,'one')&&array_contain(gongSiBiXiuCongType,getQueryString('type'))){
                for(var i=0;i<xinBiXiuID.length;i++){
                    for(var u=0;u<imgs2.length;u++){
                        if(xinBiXiuID[i]==imgs2[u].id){
                            imgs[u].style.display="inline";
                        }
                    }
                }
            }
        }

    }
    xianShiYuanDian();
    /*判断数组是否包含某个值*/
    function array_contain(array, obj){
        for (var i = 0; i < array.length; i++){
            if (array[i] == obj)/*如果要求数据类型也一致，这里可使用恒等号===*/
                return true;
        }
        return false;
    }
    /*根据必修类别与传进的类别进行对比，然后将相同类型的必修ID赋值到新数组*/
    function array_assignment(gongSiBiXiuCongType,gongSiBiXiuID,obj){
        var file_array=new Array();
        for(var i=0;i<gongSiBiXiuCongType.length;i++){
            if(gongSiBiXiuCongType[i]==obj){
                file_array.push(gongSiBiXiuID[i]);
            }
        }
        return file_array;
    }
</script>

<script>
    if (getQueryString('kind') != null) {/*微信公众号使用*/
        var tm = getQueryString('kind');
        if (tm == "qztz") {
            var menuname = getQueryString1("menuname");
            document.getElementById("menu2").innerText = menuname;
            document.getElementById("timu").style.display = "block";
            document.getElementById("body1").style.margin="0px";
        }
    }
</script>
</html>
